
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tell Them This Isn‚Äôt Working</title>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Open Sans', sans-serif;
      background-color: #f8f9fa;
      color: #333;
      max-width: 900px;
      margin: 40px auto;
      padding: 30px;
      border-radius: 10px;
      background: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    h1 {
      text-align: center;
      font-size: 2.8em;
      color: #cc0000;
      margin-bottom: 20px;
    }
    .intro {
      background: #f0f5ff;
      padding: 15px 20px;
      border-left: 5px solid #003f7d;
      border-radius: 5px;
      margin-bottom: 25px;
    }
    label { display: block; margin: 12px 0 6px; font-weight: 600; }
    input[type="text"], textarea {
      width: 100%; padding: 10px; font-size: 1em; margin-bottom: 15px;
      border: 1px solid #ccc; border-radius: 5px; font-family: inherit; min-height: 44px;
    }
    textarea { resize: vertical; }
    input:focus, textarea:focus, button:focus { outline: 2px solid #005fa3; outline-offset: 2px; }
    .issue-list, fieldset.picker {
      border: 1px solid #ccc; background: #f1f1f1; padding: 15px 20px; margin-top: 20px; border-radius: 5px;
    }
    .issue-list label, .picker label { font-weight: 600; margin: 8px 0; font-size: 1.05em; display: flex; align-items: center; }
    .issue-list input[type="checkbox"], .picker input[type="checkbox"] { margin-right: 10px; transform: scale(1.2); }
    .row { display: flex; gap: 16px; align-items: center; flex-wrap: wrap; }
    .row > label { margin: 0; }
    .hint { font-size: 0.95em; color: #555; margin-top: 6px; }
    button {
      margin-top: 25px; padding: 14px 24px; font-size: 1.1em; background-color: #0077cc; color: white;
      border: none; cursor: pointer; border-radius: 6px; transition: background-color 0.3s ease; min-height: 44px; font-family: inherit;
    }
    button:hover { background-color: #005fa3; }
    #mailtoLink { display: inline-block; margin-top: 30px; font-weight: bold; font-size: 1.1em; background-color: #0077cc; color: white; padding: 12px 18px; border-radius: 6px; text-decoration: none; transition: background-color 0.3s ease; }
    #mailtoLink:hover { background-color: #005fa3; }
    footer { margin-top: 30px; border-top: 1px solid #ddd; padding-top: 16px; font-size: 0.95em; color: #444; }
    .sr-only { position: absolute; left: -9999px; }
    #preview { background:#fff7e6; border-left:5px solid #ff9900; }
    @media (max-width: 600px) {
      body { padding: 20px; }
      label { font-size: 1.05em; }
      input[type="text"], textarea { font-size: 1em; padding: 12px; }
      button { font-size: 1em; padding: 12px 20px; }
      .row { gap: 8px; }
    }
  </style>
</head>
<body>
  <div style="background: linear-gradient(90deg, #0051a3, #0077cc); padding: 30px 20px; border-radius: 12px; text-align: center; margin-bottom: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
    <h1 style="color: white; font-size: 2.5em; margin: 0;">Tell Them This Isn‚Äôt Working</h1>
    <p style="color: #e0f0ff; font-size: 1.1em; margin-top: 8px;">Real Voices. Real Streets. Real Problems.</p>
  </div>

  <div class="intro">
    <strong>Why does this tool exist?</strong><br><br>
    This tool helps you send a clear, personal email about how the pavement parking ban is working in practice on your street‚Äîwithout writing from scratch. Every message is unique and harder to dismiss. Add your details, tick the issues that apply, and we‚Äôll open a ready-to-send email to your representatives.
  </div>

  <form aria-describedby="statusMsg" novalidate>
    <div id="statusMsg" aria-live="polite" class="sr-only"></div>

    <label for="name">Your Name:</label>
    <input type="text" id="name" placeholder="e.g. Robert Bruce" autocomplete="name" required>

    <label for="address">Your Address:</label>
    <input type="text" id="address" placeholder="e.g. 6 Charlotte Square" autocomplete="street-address" required>

    <label for="postcode">Postcode:</label>
    <input type="text" id="postcode" placeholder="e.g. EH2 4DR" autocomplete="postal-code" required>

    <fieldset class="issue-list" aria-labelledby="issuesHeading" aria-describedby="issuesHint">
      <legend id="issuesHeading"><strong>Select the concerns that affect your street:</strong></legend>
      <label><input type="checkbox" id="selectAll"> Select all</label>
      <label><input type="checkbox" value="emergency"> üöë Emergency vehicles could be blocked</label>
      <label><input type="checkbox" value="accessibility"> ‚ôøÔ∏è Accessibility needs not considered</label>
      <label><input type="checkbox" value="prams"> üßí Children and prams forced to share reduced road space</label>
      <label><input type="checkbox" value="bins"> üöÆ Bin collections missed or disrupted</label>
      <label><input type="checkbox" value="elderly"> üßì Elderly residents struggling with distance to car</label>
      <label><input type="checkbox" value="visitors"> üè† Visitors and tradespeople can‚Äôt park</label>
      <label><input type="checkbox" value="danger"> ‚ö†Ô∏è Danger now worse than before</label>
      <label><input type="checkbox" value="blocked"> üóëÔ∏è Pavements already blocked by council bins</label>
      <label><input type="checkbox" value="gardens"> üå± People paving over gardens due to pressure for parking</label>
      <label><input type="checkbox" value="blanket"> ‚ùå Blanket enforcement punishes everyone</label>
      <label><input type="checkbox" value="consultation"> üßæ No consultation with residents</label>
      <label><input type="checkbox" value="cohesion"> üß± Policy damaging social cohesion</label>
      <label><input type="checkbox" value="blanket20mph"> üöó Blanket 20mph limit being imposed</label>
      <div id="issuesHint" class="hint">Tick only the points that actually apply to your street.</div>
    </fieldset>

    <fieldset class="picker" aria-labelledby="asksHeading">
      <legend id="asksHeading"><strong>What should they do? (choose any)</strong></legend>
      <label><input type="checkbox" value="partialKerb" class="ask"> Trial marked partial-kerb tolerances on suitable streets</label>
      <label><input type="checkbox" value="bays" class="ask"> Provide signed on-street bays where pavements remain passable</label>
      <label><input type="checkbox" value="timeWindows" class="ask"> Allow time-limited exemptions for carers and essential trades</label>
      <label><input type="checkbox" value="pause" class="ask"> Pause blanket enforcement pending consultation</label>
    </fieldset>

    <div class="row" style="margin-top: 14px;">
      <label for="tone"><span class="sr-only">Tone</span></label>
      <select id="tone" aria-label="Email tone">
        <option value="neutral" selected>Neutral</option>
        <option value="formal">Super‚Äëformal</option>
        <option value="plain">Plain‚ÄëEnglish</option>
        <option value="stronger">Stronger (still polite)</option>
      </select>
      <label><input type="checkbox" id="plainMode"> Plain email (no emojis)</label>
      <label><input type="checkbox" id="includeAgenda"> Include wider policy concerns</label>
      <label><input type="checkbox" id="ccCampaign" checked> CC the campaign inbox</label>
    </div>

    <label for="other" style="margin-top: 12px;">Write your own concerns:</label>
    <textarea id="other" rows="4" placeholder="Write anything else you want to include..."></textarea>

    <button type="button" id="openBtn">Open Email</button>
  </form>

  <div id="preview" class="intro" style="display:none;margin-top:18px">
    <strong>Email preview</strong>
    <div style="margin-top:8px"><em id="previewSubject"></em></div>
    <textarea id="previewBody" rows="12" readonly style="margin-top:10px; width:100%"></textarea>
    <button type="button" id="copyBtn">Copy to clipboard</button>
  </div>

  <footer>
    <p>We don‚Äôt store your details. The email opens in your own email app. If your email app doesn‚Äôt open, use the preview to copy and paste.</p>
  </footer>

<script>
  // --- Generic, hedged variants (street-agnostic) ---
  const issues = {
    emergency: [
      "I‚Äôm concerned emergency vehicles may be delayed when all parking is pushed fully onto the carriageway. On many residential streets, that reduces manoeuvring space at the very moment seconds matter.",
      "Emergency access appears tighter when vehicles cannot use the kerb edge at all. Larger vehicles like ambulances and fire engines have less room to pass safely and quickly.",
      "Shifting every car fully onto the road narrows usable space for responders. I don‚Äôt think that was the intention, but it‚Äôs an outcome we should take seriously."
    ],
    accessibility: [
      "People with reduced mobility, temporary injuries, or pushchairs often need to park near home. With limited alternatives, the rules are making everyday life harder for those who already face challenges.",
      "For residents who can‚Äôt comfortably walk longer distances, the change reduces accessibility in practice, rather than improving it.",
      "Those using walking aids or managing health conditions now face longer and more difficult routes between car and door. That isn‚Äôt a more inclusive outcome."
    ],
    prams: [
      "Where pavements are uneven or already constrained, families with prams are being pushed to share narrower road space. That feels less safe than before.",
      "With all vehicles fully on-road and pavements still cluttered at times, the available space for prams and young children is tighter and more stressful to navigate.",
      "The intention was safer walking, but the practical result is prams moving closer to moving traffic on many streets."
    ],
    bins: [
      "Waste collection seems harder, not easier. Narrower passing gaps mean larger vehicles must edge through tight spaces, raising the risk of scrapes, delays, and missed uplifts.",
      "Bin lorries are having to negotiate narrower approaches, sometimes mounting the kerb to proceed. That doesn‚Äôt feel safer or more sustainable.",
      "Essential services are affected too. When the carriageway is fully occupied, access for waste vehicles is more difficult and damage risk rises."
    ],
    elderly: [
      "For older residents, extra distance between car and home is a genuine barrier. The policy doesn‚Äôt seem to account for that day-to-day reality.",
      "What looks like a short walk on paper can be a major obstacle in practice for elderly neighbours. We should support independence, not reduce it.",
      "Nearby parking helps older residents remain active and connected. Removing that option makes ordinary tasks significantly tougher."
    ],
    visitors: [
      "Visitors, carers, and tradespeople struggle to stop legally and practically. This complicates repairs, care visits, and family support.",
      "Everyday life is harder when there‚Äôs nowhere reasonable for carers or trades to pause. Tight timing and equipment needs aren‚Äôt reflected in the current setup.",
      "Hosting visitors or arranging work now means navigating restrictions that don‚Äôt fit real-world needs."
    ],
    danger: [
      "Rather than improving safety, the new layout can increase tension and reduce visibility. Passing and reversing feel riskier in tighter lanes.",
      "When all parking is forced onto the carriageway, sightlines shorten and close-call risks rise‚Äîespecially near junctions and bends.",
      "In practice, narrower lanes and fewer refuge options for pedestrians don‚Äôt feel like a safer outcome."
    ],
    blocked: [
      "Pavements are often obstructed by council bins‚Äîespecially on collection days. It‚Äôs inconsistent to penalise residents while this recurring obstruction isn‚Äôt addressed.",
      "Many pavements are already difficult to use several days a week due to bins left out. If access is the goal, that needs solving too.",
      "The policy‚Äôs stated aim is pedestrian access, yet routine bin placement already blocks pavements. That double standard should be resolved."
    ],
    gardens: [
      "Some neighbours feel pressured to pave front gardens to create driveways. That reduces greenery, harms drainage, and diminishes the street‚Äôs character.",
      "We‚Äôre seeing more hardstanding where gardens used to be, driven by necessity rather than choice. That‚Äôs a poor environmental trade-off.",
      "Driveway conversions are increasing because residents feel they have no workable alternative, which isn‚Äôt a sustainable outcome."
    ],
    blanket: [
      "A single rule is being applied to very different streets and contexts. That feels like automation, not proportionate enforcement.",
      "Parking that functioned safely for years is now penalised, while genuine obstructions aren‚Äôt distinguished. Flexibility and judgement are missing.",
      "Universal prohibition treats unlike situations the same. We need discretion that recognises local layouts and lived experience."
    ],
    consultation: [
      "There hasn‚Äôt been meaningful, street-level consultation. Residents most affected haven‚Äôt been properly engaged before rollout.",
      "People weren‚Äôt asked how the change would work in practice where they live. It arrived first, with dialogue afterwards‚Äîif at all.",
      "Major changes like this should include local voices early. That hasn‚Äôt happened in a way people recognise."
    ],
    cohesion: [
      "Where neighbours previously cooperated informally, we now anticipate more complaints and friction. That erodes a sense of community.",
      "This is creating conflict over limited space as people try to comply with a rigid rule. That‚Äôs not how strong neighbourhoods are built.",
      "Parking used to be managed with courtesy and common sense. The new approach is driving a wedge between people on the same street."
    ],
    blanket20mph: [
      "A blanket 20mph rollout is being applied regardless of local context or risk. Slowing traffic in high-risk areas makes sense; applying the same rule everywhere without clear evidence or an enforcement focus is harder to justify‚Äîespecially alongside the parking changes."
    ]
  };
</script>

<script>
  // --- Subject lines (neutrals added) ---
  const subjectLines = [
    "Local impacts of parking rules",
    "Practical fixes needed on our street",
    "Resident feedback on pavement parking ban",
    "Evidence-led adjustments requested",
    "Access and safety: unintended effects",
    "Please review local outcomes",
    "Street-level issues and options",
    "One size doesn‚Äôt fit our street",
    "Safer access needs flexibility",
    "Consult residents before enforcing",
    "Let‚Äôs trial workable alternatives",
    "Seeking proportionate enforcement",
    // keep a few of your originals, toned down
    "This policy isn‚Äôt working here",
    "Please pause and review the parking ban",
    "The policy isn‚Äôt achieving its aims"
  ];
</script>

<script>
  // --- Data loading & helpers ---
  async function init() {
    window.isReady = false;

    const mspData = await fetch('mspContacts.json').then(res => res.json());

    const normalize = str => str?.toLowerCase().replace(/[^a-z0-9]/g, '').trim();
    window.normalize = normalize;

    window.apiKey = "6946df58f97fd1b9aad7493a65c4cf8cbc8ddb3b"; // MapIt key
    window._mspData = mspData;

    const normalizedRegions = {};
    Object.keys(mspData.regions).forEach(regionName => {
      normalizedRegions[normalize(regionName)] = mspData.regions[regionName];
    });
    mspData.regions = normalizedRegions;

    window.mspData = mspData;
    window.isReady = true;
  }

  function uniqueEmails(list) {
    return [...new Set((list || []).map(e => String(e||'').trim()).filter(Boolean))];
  }

  function buildMailto(toList, subject, body, ccList=[]) {
    const MAX_TO = 30; // client safety cap
    const to = uniqueEmails(toList).slice(0, MAX_TO).join(',');
    const cc = uniqueEmails(ccList).join(',');
    const enc = s => encodeURIComponent(s.replace(/\n/g, '\r\n'));
    return `mailto:${to}?subject=${enc(subject)}${cc ? `&cc=${encodeURIComponent(cc)}`:''}&body=${enc(body)}`;
  }

  function showStatus(msg){ const el=document.getElementById('statusMsg'); el.textContent = msg; }

  function normalisePostcode(pc){
    const s = pc.replace(/[^A-Za-z0-9]/g,'').toUpperCase();
    if (s.length < 5) return pc.toUpperCase().trim();
    return s.slice(0, -3) + ' ' + s.slice(-3);
  }

  function stripEmojis(s){ return s.replace(/[\p{Emoji_Presentation}\p{Extended_Pictographic}]/gu, '').replace(/\s{2,}/g,' ').trim(); }

  const mitigationCore =
    "Please pause enforcement on residential streets where the rules are clearly creating practical problems, and open an evidence-led consultation with residents. Either amend the legislation and guidance to allow workable, signposted solutions on suitable streets (e.g., marked partial-kerb tolerances, designated bays, time-based allowances), or accept that a blanket approach is unworkable and repeal it.";

  const mitigationAgendaOptional =
    "Some of us are also concerned about the wider policy direction behind these changes. If wider aims are influencing local decisions, that should be discussed openly with residents rather than assumed.";

  const toneOpeners = {
    neutral: [
      (n,a,p)=>`My name is ${n}, and I live at ${a}, ${p}. I‚Äôm writing about how the pavement parking ban is working in practice on residential streets like ours. The intention is understood, but the day-to-day effects are creating avoidable problems.`,
      (n,a,p)=>`I‚Äôm ${n} at ${a}, ${p}. I support safer access, but the current approach is creating avoidable problems on our street.`,
      (n,a,p)=>`${n} here from ${a}, ${p}. The intention behind the ban is clear; the outcomes on our street are not working as hoped.`
    ],
    formal: [
      (n,a,p)=>`${n}, ${a}, ${p}. I write to set out specific concerns regarding the practical operation of the pavement parking provisions within our area.`,
      (n,a,p)=>`I am ${n} of ${a}, ${p}. I respectfully request that you review the implementation of the pavement parking prohibitions in light of the impacts described below.`
    ],
    plain: [
      (n,a,p)=>`I‚Äôm ${n} at ${a}, ${p}. Here‚Äôs what isn‚Äôt working with the new pavement parking rules on our street.`,
      (n,a,p)=>`${n} from ${a}, ${p}. The rules make day‚Äëto‚Äëday life harder in the ways listed below.`
    ],
    stronger: [
      (n,a,p)=>`${n} here from ${a}, ${p}. The current approach isn‚Äôt working on our street, and we need proportionate, practical fixes.`,
      (n,a,p)=>`I‚Äôm ${n} at ${a}, ${p}. The policy outcomes below need urgent attention and adjustment.`
    ]
  };

const openers = [
    (n,a,p)=>`My name is ${n}, and I live at ${a}, ${p}. I‚Äôm writing about how the pavement parking ban is working in practice on residential streets like ours. The intention is understood, but the day-to-day effects are creating avoidable problems.`,
    (n,a,p)=>`I‚Äôm ${n} at ${a}, ${p}. I support safer access, but the current approach is creating avoidable problems on our street.`,
    (n,a,p)=>`${n} here from ${a}, ${p}. The intention behind the ban is clear; the outcomes on our street are not working as hoped.`
  ];

  function buildMessage({ name, address, postcode, chosenLines, includeAgenda=false, plain=false, chosenAsks=[], tone='neutral' }) {
    const newline = '\n\n';
    const greeting = (tone==='formal') ? 'Dear MSPs and Councillors,' : 'Dear MSPs and Councillors,';
    const bank = (toneOpeners[tone] || toneOpeners.neutral);
    const opening = bank[Math.floor(Math.random()*bank.length)](name,address,postcode);
    const concerns = `Specific concerns from our area include:${newline}${chosenLines.join(newline)}`;
    const asksExtras = chosenAsks.length ? (' ' + chosenAsks.join(' ')) : '';
    const asks = mitigationCore + (includeAgenda ? (' ' + mitigationAgendaOptional) : '') + asksExtras;
    const close = 'I‚Äôd appreciate a response on what you can do in the short term to relieve these pressures, and how residents will be involved in shaping a practical, fair, and safe approach.';

    let body = `${greeting}${newline}${opening}${newline}${concerns}${newline}${asks}${newline}${close}${newline}${(tone==='formal'?'Yours sincerely,':'Kind regards,')}${newline}${name}`;
    if (tone==='formal' || tone==='plain') plain = true;
    if (plain) body = stripEmojis(body);
    return body;
  }

  async function getEmailsFromPostcode(postcode) {
    const url = `https://mapit.mysociety.org/postcode/${encodeURIComponent(postcode)}?api_key=${window.apiKey}`;
    const res = await fetch(url);
    if (!res.ok) throw new Error('Postcode lookup failed.');
    const data = await res.json();
    const areas = data.areas || {};

    let spc = null, spe = null;
    for (const area of Object.values(areas)) {
      if (area.type === 'SPC') spc = area.name;
      if (area.type === 'SPE') spe = area.name;
    }

    const mspKey = Object.keys(window._mspData.constituencies).find(key => window.normalize(key) === window.normalize(spc));
    const msp = mspKey ? window._mspData.constituencies[mspKey] : null;
    const regionalMSPs = window._mspData.regions[window.normalize(spe)] || [];

    const normalizedPostcode = window.normalize(postcode);
    const postcodePrefix = postcode.trim().toUpperCase().split(' ')[0];
    let councillors = [];

    const jsPath = `data/${postcodePrefix}.js`;
    try {
      await new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = jsPath;
        script.onload = () => resolve();
        script.onerror = () => reject(`Failed to load script: ${jsPath}`);
        document.head.appendChild(script);
      });
      councillors = window.postcodeToWardKey?.[normalizedPostcode] || [];
    } catch (err) {
      console.warn(err);
    }

    return { msps: [msp, ...regionalMSPs].filter(Boolean), councillors };
  }

  window.generateEmail = async function () {
    if (!window.isReady) {
      alert('Still loading data. Please wait a moment and try again.');
      return;
    }

    const name = document.getElementById('name').value.trim();
    const address = document.getElementById('address').value.trim();
    const postcodeRaw = document.getElementById('postcode').value.trim();
    const postcode = normalisePostcode(postcodeRaw);
    const other = document.getElementById('other').value.trim();
    const includeAgenda = document.getElementById('includeAgenda').checked;
    const plainMode = document.getElementById('plainMode').checked;

    const allCheckboxes = document.querySelectorAll('.issue-list input[type="checkbox"]');
    const checkboxes = Array.from(allCheckboxes).filter(cb => cb.checked && cb.id !== 'selectAll');

    if (!name || !address || !postcode) {
      alert('Please fill in your name, address, and postcode.');
      showStatus('Missing required fields.');
      return;
    }

    if (checkboxes.length === 0 && !other) {
      alert('Please select at least one concern or fill in the other box.');
      showStatus('No concerns selected.');
      return;
    }

    const selectedSubjects = checkboxes.map(cb => cb.value);
    let chosenLines = selectedSubjects.map(issue => {
      const options = issues[issue];
      return options[Math.floor(Math.random() * options.length)];
    });

    if (other) chosenLines.push(other);
    if (plainMode) chosenLines = chosenLines.map(stripEmojis);

    // collect chosen asks
    const message = buildMessage({
      name, address, postcode,
      chosenLines,
      includeAgenda,
      plain: plainMode,
      chosenAsks: asksChosen,
      tone: (document.getElementById('tone')?.value || 'neutral')
    });

    const subject = subjectLines[Math.floor(Math.random() * subjectLines.length)];

    // Preview first
    document.getElementById('previewSubject').textContent = subject;
    const ta = document.getElementById('previewBody');
    ta.value = message;
    document.getElementById('preview').style.display = 'block';

    try {
      const repData = await getEmailsFromPostcode(postcode);

      const emails = [];
      if (repData.msps?.length) repData.msps.forEach(msp => { if (msp?.email) emails.push(msp.email); });
      if (repData.councillors?.length) repData.councillors.forEach(c => { if (c?.email) emails.push(c.email); });

      const toEmails = [...new Set(emails.map(e=>String(e||'').trim()).filter(Boolean))].slice(0,30);
      if (toEmails.length === 0) {
        alert('We couldn‚Äôt find any email contacts for that postcode. You can still copy the preview and send it manually.');
        showStatus('No contacts found for that postcode.');
        return;
      }

      const cc = document.getElementById('ccCampaign').checked ? ['thepavementtrap@gmail.com'] : [];
      const mailtoLink = buildMailto(toEmails, subject, message, cc);

      const tempLink = document.createElement('a');
      tempLink.href = mailtoLink;
      tempLink.style.display = 'none';
      document.body.appendChild(tempLink);
      tempLink.click();
      document.body.removeChild(tempLink);

      setTimeout(() => {
        alert('If your email app didn‚Äôt open, please check your browser settings or copy the text from the preview.');
      }, 800);
    } catch (error) {
      console.error('Error fetching representatives:', error);
      alert('Something went wrong looking up your representatives. Use the preview to copy and send manually.');
      showStatus('Lookup error. Try again later.');
    }
  };

  document.getElementById('selectAll').addEventListener('click', function () {
    const isChecked = this.checked;
    const checkboxes = document.querySelectorAll('.issue-list input[type="checkbox"]');
    checkboxes.forEach(cb => { if (cb.id !== 'selectAll') cb.checked = isChecked; });
  });

  document.getElementById('openBtn')?.addEventListener('click', () => window.generateEmail());
  document.getElementById('copyBtn')?.addEventListener('click', async ()=>{
    try { await navigator.clipboard.writeText(document.getElementById('previewBody').value); alert('Copied. Paste into your email app.'); }
    catch { const ta=document.getElementById('previewBody'); ta.select(); document.execCommand('copy'); alert('Copied (legacy).'); }
  });

  init();
</script>
</body>
</html>
