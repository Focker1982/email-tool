<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tell Them This Isnâ€™t Working</title>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Open Sans', sans-serif;
      background-color: #f8f9fa;
      color: #333;
      max-width: 900px;
      margin: 40px auto;
      padding: 30px;
      border-radius: 10px;
      background: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    h1 {
      text-align: center;
      font-size: 2.8em;
      color: #cc0000;
      margin-bottom: 20px;
    }
    .intro {
      background: #e7f1fc;
      padding: 15px 20px;
      border-left: 5px solid #0051a3;
      border-radius: 5px;
      margin-bottom: 25px;
    }
    label {
      display: block;
      margin: 12px 0 6px;
      font-weight: 600;
    }
    input[type="text"], textarea {
      width: 100%;
      padding: 10px;
      font-size: 1em;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-family: inherit;
      min-height: 44px;
    }
    textarea { resize: vertical; }
    input:focus, textarea:focus, button:focus {
      outline: 2px solid #005fa3;
      outline-offset: 2px;
    }
    .issue-list {
      border: 1px solid #ccc;
      background: #f1f1f1;
      padding: 15px 20px;
      margin-top: 20px;
      border-radius: 5px;
    }
    .issue-list label {
      font-weight: 600;
      margin: 8px 0;
      font-size: 1.05em;
      display: flex;
      align-items: center;
    }
    .issue-list input[type="checkbox"] {
      margin-right: 10px;
      transform: scale(1.2);
    }
    button {
      margin-top: 25px;
      padding: 14px 24px;
      font-size: 1.1em;
      background-color: #0077cc;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 6px;
      transition: background-color 0.3s ease;
      min-height: 44px;
      font-family: inherit;
    }
    button:hover { background-color: #005fa3; }
    #mailtoLink {
      display: inline-block;
      margin-top: 30px;
      font-weight: bold;
      font-size: 1.1em;
      background-color: #0077cc;
      color: white;
      padding: 12px 18px;
      border-radius: 6px;
      text-decoration: none;
      transition: background-color 0.3s ease;
    }
    #mailtoLink:hover { background-color: #005fa3; }
    footer {
      margin-top: 50px;
      border-top: 1px solid #ddd;
      padding-top: 20px;
      font-size: 0.95em;
      color: #444;
    }
    @media (max-width: 600px) {
      body { padding: 20px; }
      label { font-size: 1.05em; }
      input[type="text"], textarea { font-size: 1em; padding: 12px; }
      button { font-size: 1em; padding: 12px 20px; }
    }
  </style>
</head>
<body>
  <div style="background: linear-gradient(90deg, #0051a3, #0077cc); padding: 30px 20px; border-radius: 12px; text-align: center; margin-bottom: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
    <h1 style="color: white; font-size: 2.5em; margin: 0;">Tell Them This Isnâ€™t Working</h1>
    <p style="color: #e0f0ff; font-size: 1.1em; margin-top: 8px;">Real Voices. Real Streets. Real Problems.</p>
  </div>

  <div class="intro" style="background: #f0f5ff; border-left: 5px solid #003f7d; margin-top: 40px;">
    <strong>Why does this tool exist?</strong><br><br>
    This tool makes it easy to add your voice to the campaign â€” without needing to write from scratch. Every message it creates is unique, personal, and harder for MSPs and Councillors to ignore or dismiss as copyâ€‘andâ€‘paste. Thatâ€™s intentional.
  </div>

  <form>
    <label for="name">Your Name:</label>
    <input type="text" id="name" placeholder="e.g. Robert Bruce" autocomplete="name" required>

    <label for="address">Your Address:</label>
    <input type="text" id="address" placeholder="e.g. 6 Charlotte Square" autocomplete="street-address" required>

    <label for="postcode">Postcode:</label>
    <input type="text" id="postcode" placeholder="e.g. EH2 4DR" autocomplete="postal-code" required>

    <div class="issue-list">
      <strong>Select the concerns that affect your street:</strong>
      <label><input type="checkbox" id="selectAll"> ğŸ”˜ Select all</label>
      <label><input type="checkbox" value="emergency"> ğŸš‘ Emergency vehicles could be blocked</label>
      <label><input type="checkbox" value="accessibility"> â™¿ï¸ Accessibility needs not considered</label>
      <label><input type="checkbox" value="prams"> ğŸ§’ Children and prams forced to share reduced road space</label>
      <label><input type="checkbox" value="bins"> ğŸš® Bin collections missed or disrupted</label>
      <label><input type="checkbox" value="elderly"> ğŸ§“ Elderly residents struggling with distance to car</label>
      <label><input type="checkbox" value="visitors"> ğŸ  Visitors and tradespeople canâ€™t park</label>
      <label><input type="checkbox" value="danger"> âš ï¸ Danger now worse than before</label>
      <label><input type="checkbox" value="blocked"> ğŸ—‘ï¸ Pavements already blocked by council bins</label>
      <label><input type="checkbox" value="gardens"> ğŸŒ± People paving over gardens due to pressure for parking</label>
      <label><input type="checkbox" value="blanket"> âŒ Oneâ€‘sizeâ€‘fitsâ€‘all enforcement</label>
      <label><input type="checkbox" value="consultation"> ğŸ§¾ Limited local consultation</label>
      <label><input type="checkbox" value="cohesion"> ğŸ§± Policy damaging social cohesion</label>
      <label><input type="checkbox" value="opposeIdeology"> ğŸ›‘ Set aside 20â€‘minute cityâ€“style frameworks</label>
      <label><input type="checkbox" value="blanket20mph"> ğŸš— Blanket 20mph applied without local tailoring</label>
    </div>

    <label for="other">Write your own concerns:</label>
    <textarea id="other" rows="4" placeholder="Add any streetâ€‘specific evidence, examples or dates you want includedâ€¦"></textarea>

    <button type="button" id="openEmailBtn">Open Email</button>
  </form>

  <footer>
    <p>This tool helps you contact your MSPs and councillors about the practical effects of the pavement parking ban on your street. You can personalise the content once it opens in your email client. Every email it generates is dynamic â€” the subject line, the phrasing, and the examples vary.</p>
  </footer>

<!-- ===== Issues + phrases (legacy-safe) ===== -->
<script>
  // All issues in one object (no Object.assign)
  var issues = {
    emergency: [
      "Iâ€™m seriously concerned weâ€™ll see delays for emergency vehicles if this layout continues. Our street is narrow, and full onâ€‘road parking leaves little room for larger vehicles to manoeuvre. If someone needed urgent help, seconds could matter â€” and this policy increases that risk.",
      "Emergency access is being compromised. When cars are forced fully onto the road, services like ambulances and fire engines may struggle to reach homes in time.",
      "By shifting all vehicles onto the road, this policy unintentionally narrows access for emergency responders. It introduces serious risk in critical situations."
    ],
    accessibility: [
      "Many residents, including the elderly and those recovering from injury, rely on being able to park near their homes. With limited legal alternatives, the ban makes daily life more difficult for people who already face mobility challenges.",
      "This policy creates unfair barriers for anyone with reduced mobility. There are no practical nearby alternatives for those who canâ€™t easily walk longer distances.",
      "The pavement parking ban overlooks the people it claims to protect. Those with walking aids, temporary injuries, or pushchairs now face longer, more difficult routes between their car and their door â€” often with no safe option."
    ],
    prams: [
      "On streets where pavements are already obstructed or uneven, walking on the road has been the only practical option for families â€” especially during poor weather. But full onâ€‘road parking now forces prams and young children into much narrower, more dangerous spaces.",
      "Families used to navigate our street safely with prams or young kids by sharing space carefully. Now, with cars parked entirely on the road and pavements still blocked by bins and clutter, the route for pedestrians is riskier than ever.",
      "Rather than protecting families, this policy makes journeys more hazardous for those with young children. The usable space has shrunk, and prams now move through traffic where there used to be a safer workaround."
    ],
    bins: [
      "The current setup makes waste collection harder, not easier. Large vehicles have to squeeze through narrow gaps or mount the kerb â€” increasing the risk of scrapes, delays, and missed collections.",
      "Itâ€™s obvious this layout puts bin collection at risk. Narrowed roads and awkward angles force council vehicles into difficult positions â€” often driving up onto pavements to get past.",
      "This ban affects not just residents but essential services too. Bin lorries will have more difficulty accessing streets fully occupied by onâ€‘road parking, and damage to parked cars becomes more likely as a result."
    ],
    elderly: [
      "For older residents, having to walk further with shopping or mobility issues is a serious challenge. The policy ignores this reality and forces a level of physical strain that many simply canâ€™t manage dayâ€‘toâ€‘day.",
      "The distance between car and home now matters more than ever â€” and for elderly people, that extra walk isnâ€™t just inconvenient, itâ€™s a real obstacle.",
      "If you live with limited mobility, even a short walk can be daunting. Removing nearby parking makes it harder for older residents to stay independent â€” and that doesnâ€™t feel like progress."
    ],
    visitors: [
      "Weâ€™re seeing far fewer visitors, tradespeople, and home support workers because thereâ€™s nowhere practical to park. This makes basic home repairs, health checkâ€‘ins, or even family visits more complicated than they should be.",
      "Essential services are being disrupted. Without local parking, it's harder for tradespeople, carers or delivery workers to stop â€” especially on tight streets with timeâ€‘sensitive work.",
      "Hosting visitors or getting help from tradespeople now requires negotiating a maze of restrictions â€” and that discourages support and community interaction."
    ],
    danger: [
      "Instead of improving safety, the new layout has increased tension on the road. Visibility is worse, space is tighter, and what used to be a calm residential route now feels more stressful for drivers and pedestrians alike.",
      "This policy hasnâ€™t made our street safer. Itâ€™s created narrower lanes, reduced escape space for pedestrians, and made passing or reversing more dangerous than before.",
      "By forcing all parking onto the road, the policy increases the chance of collisions and close calls â€” particularly where visibility is already limited."
    ],
    blocked: [
      "Pavements in our area are regularly obstructed by council bins â€” especially on collection days. Itâ€™s frustrating to be told weâ€™re creating access issues when the pavement isnâ€™t usable in the first place.",
      "Even before the ban, residents had to navigate around multiple council bins left out on narrow pavements. Penalising residents while ignoring that reality feels inconsistent and unfair.",
      "The ban claims to protect pedestrian access, yet bins â€” placed or left by the council â€” already make many pavements impassable several days a week. This double standard needs to be addressed."
    ],
    gardens: [
      "The pressure to find legal parking is leading some neighbours to pave over their front gardens. This damages local drainage, reduces greenery, and creates a colder, less inviting street environment.",
      "Weâ€™ve seen more gardens replaced with concrete as people try to comply. Itâ€™s an unfortunate environmental tradeâ€‘off that hurts biodiversity and increases flood risk.",
      "Driveway conversions are becoming more common, not because residents want them, but because they feel forced. Thatâ€™s not a sustainable outcome for our communities or the climate."
    ],
    blanket: [
      "The same rule is being applied to all streets, no matter their layout or history of issues. Thatâ€™s not enforcement â€” thatâ€™s automation. Residents deserve better than oneâ€‘sizeâ€‘fitsâ€‘all punishment.",
      "By criminalising parking that worked safely for years, this policy alienates responsible residents. Enforcement should be focused on real obstructions â€” not routine, practical parking.",
      "A universal ban treats all situations the same, regardless of context. We need flexibility and discretion â€” not robotic enforcement that ignores lived experience."
    ],
    consultation: [
      "This policy was introduced without meaningful consultation at the street level. Residents like us have been left out of the discussion entirely, despite being directly affected.",
      "Thereâ€™s been no honest engagement with our community. People were not asked how the ban would impact them â€” they were simply told after the fact.",
      "A major change like this should include local voices. Instead, itâ€™s been rolled out from the top down, with no opportunity to raise concerns before it hit the ground."
    ],
    cohesion: [
      "Restrictions that remove informal arrangements can strain neighbourly cooperation.",
      "Changes to parking rules will create disputes over limited space and parking.",
      "Maintaining community goodwill is easier when local solutions are supported alongside policy."
    ],
    opposeIdeology: [
      "I do not support the application of 20â€‘minute cityâ€“style planning where it restricts everyday access. This approach should be removed from local transport policy.",
      "20â€‘minute city frameworks should not be used to shape streetâ€‘level parking or access rules. They do not reflect the needs of residents in practice.",
      "I reject the use of 20â€‘minute city principles in local access planning. Where applied, they should be withdrawn in favour of practical, streetâ€‘tested solutions."
    ],
    blanket20mph: [
      "I do not support a universal 20mph speed limit. It should be reversed in favour of targeted limits where they are genuinely needed.",
      "Blanket 20mph zones are inappropriate and should be replaced with speed management based on actual local risk.",
      "This area would be better served by retaining existing speed limits. I do not support the proposal of a universal 20mph speed limit."
    ]
  };

  // Dynamic openers & subject lines
  var impactOpeners = [
    "The pavement parking changes are making our street harder to use safely and practically.",
    "On our street, the pavement parking changes arenâ€™t working as intended.",
    "These rules are affecting everyday access and safety on our street.",
    "As applied, the pavement parking rules are not working for our street.",
    "If enforced as planned, these rules would reduce access and safety on our street.",
    "In practice, this policy isnâ€™t achieving safer, more accessible conditions on our street."
  ];

  var subjectLines = [
    "Request for review of pavement parking policy",
    "Pause and review to improve street access",
    "Local impacts and needed adjustments to parking rules",
    "Evidence from residents on pavement parking changes",
    "Making parking rules work for all users",
    "Balancing safety and access on local streets",
    "Call for practical review of parking restrictions",
    "How to deliver safer, more accessible streets",
    "Concerns about current pavement parking approach",
    "Improving policy outcomes through local review",
    "Ensuring parking policy matches real street conditions",
    "Request for pause before full enforcement",
    "Working together to fix unintended impacts",
    "Reviewing the impact on residents and services",
    "Practical solutions for safer local streets"
  ];
</script>

<!-- ===== Legacy-safe logic (no modern JS) ===== -->
<script>
  // XHR JSON helper
  function xhrGetJSON(url, cb) {
    try {
      var x = new XMLHttpRequest();
      x.open("GET", url, true);
      x.onreadystatechange = function () {
        if (x.readyState === 4) {
          if (x.status >= 200 && x.status < 300) {
            try { cb(null, JSON.parse(x.responseText)); } catch (e) { cb(e); }
          } else { cb(new Error("HTTP " + x.status)); }
        }
      };
      x.send();
    } catch (e) { cb(e); }
  }

  function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
  function normalize(s){ s = (s || ""); if (s.toLowerCase) s = s.toLowerCase(); return s.replace(/[^a-z0-9]/g,'').trim(); }

  function dedupeByStem(lines){
    var seen = {};
    var out = [];
    for (var i=0;i<lines.length;i++){
      var key = String(lines[i]).toLowerCase().replace(/[^a-z\s]/g,'').split(/\s+/).slice(0,12).join(' ');
      if (!seen[key]) { seen[key] = 1; out.push(lines[i]); }
    }
    return out;
  }

  function fuseShort(lines){
    var joiners = ["In addition,", "Meanwhile,", "At the same time,"];
    var out = [];
    for (var i=0;i<lines.length;i++){
      if (i<lines.length-1 && lines[i].length<=220 && lines[i+1].length<=220 && Math.random()<0.35){
        out.push(lines[i] + " " + pick(joiners) + " " + lines[i+1]);
        i++;
      } else {
        out.push(lines[i]);
      }
    }
    return out;
  }

  function cleanOther(text) {
    var t = (text || "").replace(/\s+/g,' ').replace(/^[\.!?,;:]+|[\.!?,;:]+$/g,'').trim();
    if (!t) return "";
    var keep = { "MSP":1,"MSPs":1,"NHS":1,"HGV":1,"EV":1,"EVs":1,"DYL":1 };
    t = t.replace(/\b([A-Z]{4,})\b/g, function(m){ return keep[m] ? m : m.charAt(0) + m.slice(1).toLowerCase(); });
    if (!/[\.!?]$/.test(t)) t += ".";
    return "In addition, " + t;
  }

  // Global data
  window.isReady = false;
  window._mspData = null;
  window.apiKey = "6946df58f97fd1b9aad7493a65c4cf8cbc8ddb3b";

  // Init mspContacts.json
  function init(){
    window.isReady = false;
    xhrGetJSON("mspContacts.json", function(err, mspData){
      // If it fails, we still allow email (just without MSP auto-fill)
      if (!err && mspData) {
        var normalized = {};
        for (var k in mspData.regions) {
          if (mspData.regions.hasOwnProperty(k)) {
            normalized[normalize(k)] = mspData.regions[k];
          }
        }
        mspData.regions = normalized;
        window._mspData = mspData;
      }
      window.isReady = true;
    });
  }

  // Lookup MSPs/Councillors
  function getEmailsFromPostcode(postcode, done){
    var url = "https://mapit.mysociety.org/postcode/" + encodeURIComponent(postcode) + "?api_key=" + window.apiKey;
    xhrGetJSON(url, function(err, data){
      if (err) return done(err);
      var areas = data && data.areas ? data.areas : {};
      var spc = null, spe = null, k, a;
      for (k in areas) {
        if (!areas.hasOwnProperty(k)) continue;
        a = areas[k];
        if (a.type === "SPC") spc = a.name;
        if (a.type === "SPE") spe = a.name;
      }
      var list = [];
      if (window._mspData && window._mspData.constituencies && spc) {
        for (k in window._mspData.constituencies) {
          if (!window._mspData.constituencies.hasOwnProperty(k)) continue;
          if (normalize(k) === normalize(spc)) { list.push(window._mspData.constituencies[k]); break; }
        }
      }
      if (window._mspData && window._mspData.regions && spe) {
        var region = window._mspData.regions[normalize(spe)] || [];
        for (var i=0;i<region.length;i++) list.push(region[i]);
      }

      // Optional councillors JS
      var councillors = [];
      var prefix = String(postcode).trim().toUpperCase().split(" ")[0];
      var jsPath = "data/" + prefix + ".js";
      var s = document.createElement("script");
      var finished = false;
      function finish(){
        if (finished) return; finished = true;
        try {
          var np = normalize(postcode);
          if (window.postcodeToWardKey && window.postcodeToWardKey[np]) {
            councillors = window.postcodeToWardKey[np];
          }
        } catch(e){}
        return done(null, { msps: list, councillors: councillors });
      }
      s.onload = function(){ setTimeout(finish, 0); };
      s.onerror = function(){ setTimeout(finish, 0); };
      try { document.head.appendChild(s); s.src = jsPath; } catch(e){ finish(); }
      setTimeout(finish, 2500);
    });
  }

  // Select-all
  function toggleAllIssues(source) {
    var boxes = document.querySelectorAll(".issue-list input[type='checkbox']");
    for (var i=0;i<boxes.length;i++){
      var cb = boxes[i];
      if (cb.id !== "selectAll") cb.checked = !!source.checked;
    }
  }
  document.getElementById("selectAll").addEventListener("click", function(){ toggleAllIssues(this); });

  // Generate email
  function generateEmail(){
    if (!window.isReady) { alert("Still loading data. Please wait a moment and try again."); return; }

    var name = (document.getElementById("name").value || "").trim();
    var address = (document.getElementById("address").value || "").trim();
    var postcode = (document.getElementById("postcode").value || "").trim();
    var other = (document.getElementById("other").value || "").trim();

    var all = document.querySelectorAll(".issue-list input[type='checkbox']");
    var selected = [];
    for (var i=0;i<all.length;i++){
      if (all[i].checked && all[i].id !== "selectAll") selected.push(all[i].value);
    }

    if (!name || !address || !postcode) { alert("Please fill in your name, address, and postcode."); return; }
    if (selected.length === 0 && !other) { alert("Please select at least one concern or add your own."); return; }

    var priority = ["emergency","danger","accessibility","prams","elderly","visitors","bins","blocked","gardens","blanket","consultation","cohesion","opposeIdeology","blanket20mph"];
    var ordered = [];
    for (var p=0;p<priority.length;p++){ if (selected.indexOf(priority[p]) !== -1) ordered.push(priority[p]); }
    for (var j=0;j<selected.length;j++){ if (priority.indexOf(selected[j]) === -1) ordered.push(selected[j]); }

    var lines = [];
    for (var m=0;m<ordered.length;m++){
      var key = ordered[m];
      var opts = (window.issues && window.issues[key]) ? window.issues[key] : [];
      if (opts.length) lines.push(opts[Math.floor(Math.random()*opts.length)]);
    }
    if (other) lines.push(cleanOther(other));
    lines = dedupeByStem(lines);
    lines = fuseShort(lines);
    lines = lines.slice(0, 8);

    var greetings = ["Dear MSPs and Councillors,","Dear Councillors and MSPs,"];
    var bridges = ["Based on what weâ€™re seeing, the realâ€‘world impacts are:","In practice on our street, this has meant:","Day to day, the effects are clear:"];
    var signoffs = ["Regards,","Yours sincerely,","Kind regards,"];
    var greet = pick(greetings), bridge = pick(bridges), signoff = pick(signoffs);

    var opener = pick(window.impactOpeners || ["The pavement parking changes are making our street harder to use safely and practically."]);
    var newline = "\n\n";
    var mitigation = "I am asking Councillors and MSPs to work together to fix this quickly. Please pause enforcement where it creates risk or reduces access, lead a rapid, evidenceâ€‘led review with residents and essential services, and make the necessary changes in both arenas â€” update local traffic orders, exemptions and enforcement practice, and press Ministers for national amendments so legislation and guidance reflect realâ€‘world conditions. The aim is simple: safe, genuinely accessible streets without avoidable harm to residents, services or the street environment.";

    var message = ""
      + greet + newline
      + "My name is " + name + ", and I live at " + address + ", " + postcode + "." + newline
      + opener + " Residents have adapted over the years to keep streets workable for everyone, but these changes risk undoing that balance. " + bridge + newline
      + lines.join(newline) + newline
      + mitigation + newline
      + signoff + newline
      + name;

    var subjects = window.subjectLines || ["Request for review of pavement parking policy"];
    var subject = subjects[Math.floor(Math.random()*subjects.length)];

    getEmailsFromPostcode(postcode, function(err, reps){
      if (err) { console.error(err); alert("Representative lookup failed. Please doubleâ€‘check the postcode."); return; }
      var emails = [];
      if (reps && reps.msps) { for (var i=0;i<reps.msps.length;i++){ if (reps.msps[i] && reps.msps[i].email) emails.push(reps.msps[i].email); } }
      if (reps && reps.councillors) { for (var k=0;k<reps.councillors.length;k++){ if (reps.councillors[k] && reps.councillors[k].email) emails.push(reps.councillors[k].email); } }

      if (!emails.length) { alert("We couldnâ€™t find any email contacts for that postcode."); return; }

      var ccAddress = "thepavementtrap@gmail.com";
      var body = message.replace(/\n/g, "%0D%0A");
      var link = "mailto:" + emails.join(",") + "?cc=" + encodeURIComponent(ccAddress) + "&subject=" + encodeURIComponent(subject) + "&body=" + body;

      var a = document.createElement("a");
      a.href = link; a.style.display = "none";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);

      setTimeout(function(){ alert("If your email app didnâ€™t open, please check your browser settings or copy the text manually."); }, 1000);
    });
  }

  document.getElementById("openEmailBtn").addEventListener("click", generateEmail);
  document.getElementById("selectAll").addEventListener("click", function(){ toggleAllIssues(this); });

  // Go
  init();
</script>
</body>
</html>
